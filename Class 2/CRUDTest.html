<!DOCTYPE html>
<html lang="en">

<!-- 

    CRUD Application

    C: Create the object
    R: Read the object
    U: update the object
    D: delete the object

 -->

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD Test</title>

    <script>

        class Person {

            static countPerson = 0; // initially no Person object will be there
            static PersonDatabase = []; // array will work as a database.
            static primary_key = 1000; // 

            // 1. Create the object.
            constructor(name, age, height, bloodgroup) {
                this.name = name;
                this.age = age;
                this.height = height;
                this.bloodgroup = bloodgroup;
                this.primarykey = Person.primary_key;

                // first add the person into PersonDatabase
                // increase the countPerson

                Person.PersonDatabase.push(this);
                Person.countPerson++;

                // increasing the primary key.
                Person.primary_key++;
            }

            // 2. Read the object.
            display() {
                console.log("Name".padEnd(15, " "), this.name);
                console.log("Age".padEnd(15, " "), this.age);
                console.log("Height".padEnd(15, " "), this.height);
                console.log("BloodGroup".padEnd(15, " "), this.bloodgroup);
            }

            inline_display(...args) {
                console.log(
                    `${this.primarykey}`.padEnd(args[0], " "),
                    `${this.name}`.padEnd(args[1], " "),
                    `${this.age}`.padEnd(args[2], " "),
                    `${this.height}`.padEnd(args[3], " "),
                    `${this.bloodgroup}`.padEnd(args[4], " "),
                )
            }

            static ShowDatabase(...args) {

                // displaying the column heading
                console.log(
                    `PrimaryKey`.padEnd(args[0], " "),
                    `Name`.padEnd(args[1], " "),
                    `Age`.padEnd(args[2], " "),
                    `Height`.padEnd(args[3], " "),
                    `BloodGroup`.padEnd(args[4], " "),
                )

                for (let i = 0; i < Person.countPerson; i++) {
                    Person.PersonDatabase[i].inline_display(...args);
                }
            }

            // 3. update the object/person
            update(obj) {

                let keys = Object.keys(obj);
                let values = Object.values(obj);

                for (let i = 0; i < keys.length; i++) {
                    //console.log("testing key: ---> ", keys[i]);
                    if (!this.#isValidKey(keys[i])) {
                        console.log(`Error: ${keys[i]} is not a valid key!..`);
                        return -1;
                    }
                }

                // Now after testing al the keys

                for (let i = 0; i < keys.length; i++) {
                    this[keys[i]] = values[i];
                }
            }

            #isValidKey(key) {

                let personKeys = Object.keys(this);

                for (let i = 0; i < personKeys.length; i++) {
                    if (personKeys[i] === key)
                        return true;
                }
                return false;
            }

            // delete the person/object
            delete() {
                if (Person.PersonDatabase.splice(this.findself(), 1)) {
                    Person.countPerson--;
                    console.log("Person Successfully deleted..");
                }
                else {
                    console.log("unable to delete the person.");
                }
            }

            findself() {

                for (let i = 0; i < Person.countPerson; i++) {
                    if (Person.PersonDatabase[i] == this) {
                        return i;
                    }

                }
            }

            static serachPerson(value = null, by = "primarykey") {
                // valid values for by parameter..
                // primarykey, name, age, height, bloodgroup
                console.log("value: ", value);
                let result = [];

                // if value is null or undefined then
                if (value == null) {
                    console.log("Error: value can't be null")
                    return -1
                }

                for (let i = 0; i < Person.countPerson; i++) {
                    //Person.PersonDatabase.length 
                    if (Person.PersonDatabase[i][by] === value) {
                        result.push(Person.PersonDatabase[i])
                    }
                }

                if (by == "primarykey") {
                    return result[0];
                }
                else {
                    return result;
                }
            }
        };


        function create_person() {

            let name = prompt("Enter the name of Person");
            let age = prompt("Enter the age of Person");
            let height = prompt("Enter the height of Person");
            let bloodgroup = prompt("Enter the bloodgroup of Person");

            let person = new Person(name, age, height, bloodgroup);

            return person;
        }

        new Person("manish", 26, 5.6, "O-");
        new Person("Abhishek", 19, 5.7, "AB+");
        new Person("varsha", 22, 5.5, "A-");
        new Person("komal", 21, 5.3, "B+");
        new Person("manish", 31, 5.7, "O+");

    </script>

</head>

<body>

</body>

</html>