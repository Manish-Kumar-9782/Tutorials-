<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0">
    <title>Tik Tak toe</title>
</head>

<body>

    <script>

        let tikTakToe = [
            [1, 2, 3],
            [4, 5, 6],
            [7, 8, 9],]

        let result = [
            ["X", "O", "X"],
            ["X", "O", "X"],
            ["O", "X", "O"],]

        const testCases = [3, 3, 2] // [nrows, ncols, diagonal]
        const testFuncs = [get_row, get_column, get_diagonal]

        // a function to display the grid
        function displayGrid(grid_array) {
            // gird_array: it is the input array to be displayed.

            // test 1: if grid_array is not an object of Type Array.
            if (!grid_array instanceof Array) {
                console.error("input grid_array is not an Array type object")
                return
            }

            // test 2: if grid_array is an object of Array but does not contain
            // n x n shape. it means number of rows and number of columns 
            // must be same.
            // an empty string to store the grid pattern
            let grid_str = "";

            // printing the tikTak grid using for loop

            // this is outer loop to handle the outer array (at depth 1)
            for (let i = 0; i < grid_array.length; i++) {

                let currentInnerArray = tikTakToe[i];
                // this it inner loop to handle the inner array (at depth 2)
                for (let j = 0; j < currentInnerArray.length; j++) {
                    grid_str += currentInnerArray[j] + "\t";
                }
                grid_str += "\n";
            }
            console.log(grid_str)
        }


        function arrayShape(array) {

            // length of the array
            let rows = array.length;
            let cols = array.map((rowItem) => rowItem.length);
            // [3,3,3]
            // here: rowItem is an inner Array of tikTakToe array.

            // testing that we have equal number of items in 
            // every row.
            if (cols.every((x) => x == cols[0])) {
                return [rows, cols[0]]
            }
            else {
                console.error("each row must have the same number of items..")
            }

        }


        function get_i(array, input) {
            let rows = arrayShape(array)[0] // -> [n,m]
            return input % rows == 0 ? input / rows - 1 : parseInt(input / rows)
        }

        function get_j(array, input) {
            let cols = arrayShape(array)[1] // -> [n,m]
            return input % cols == 0 ? cols - 1 : input % cols - 1
        }

        function get_ij(array, input) {
            let i = get_i(array, input)
            let j = get_j(array, input)
            return [i, j]
        }


        function update_array(array, index, value) {

            // first we will unpack the index array into i and j.
            [i, j] = index
            // Now assign the value into the array using the index i and j.
            array[i][j] = value
        }


        function get_row(array, index) {
            return array[index]
        }

        function get_column(array, index) {
            return array.map((row) => row[index])
        }

        function get_diagonal(array, index) {
            // 0: first diagonal
            // 1: second diagonal
            switch (index) {
                case 0:
                    return array.map((innerArray, i) => innerArray[i])

                case 1:
                    return array.map((innerArray, i) => innerArray[array.length - i - 1])
                default:
                    console.error("Invalid index for diagonal")
            }
        }

        function all(array, value) {
            return array.every((item) => item == value)
        }


        function test_result(array) {
            // initially we don't have any winner.
            let X = false
            let O = false

            // for all cases
            for (let tests = 0; tests < testCases.length; tests++) {
                let test_func = testFuncs[tests]

                for (let test = 0; test < testCases[tests]; test++) {
                    let arr = test_func(array, test)
                    X = all(arr, "X") // if X is true, then X is winner
                    O = all(arr, "O") // if O is true, then O is winner

                    // only one of them will be winner at a time.
                    if (X || O) {
                        return X ? "X" : "O"
                    }
                }
            }// if in above for loop, we don't have any winner then we will return 
            // false.
            return false
        }

        function play_game() {
            // creating an infinite loop for our game
            let player = "X";

            while (true) {
                // first of all, display the grid
                displayGrid(tikTakToe)

                // now ask player to choose the input
                let input = prompt(`Player ${player}:`)

                // getting i and j values.
                let index = get_ij(tikTakToe, input)

                update_array(tikTakToe, index, player)

                // switching the player.
                player == "X" ? player = "O" : player = "X"

                // testing the result
                let winner = test_result(tikTakToe)

                if (winner) {
                    displayGrid(tikTakToe)
                    console.log("Winner: ", winner)
                    break;
                }
            }
        }
    </script>

</body>

</html>